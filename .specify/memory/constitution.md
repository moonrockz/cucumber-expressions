<!--
Sync Impact Report
- Version change: 0.0.0 → 1.0.0
- Added sections: All (initial constitution)
- Templates requiring updates: ⚠ pending (templates not yet customized)
- Follow-up TODOs: None
-->

# Cucumber Expressions for MoonBit Constitution

## Core Principles

### I. Spec Compliance First

This library MUST faithfully implement the [Cucumber Expressions specification](https://github.com/cucumber/cucumber-expressions). The official test suite is the source of truth. Any deviation from spec behavior is a bug, not a feature. When the spec is ambiguous, follow the behavior of the reference JavaScript implementation.

### II. Standalone Library

This package (`moonrockz/cucumber-expressions`) MUST have zero dependencies on moonspec, gherkin, or any other moonrockz package. It depends only on `moonbitlang/x` (MoonBit standard library). It is a general-purpose pattern matching library usable by any MoonBit project.

### III. Algebraic Data Types

Model the expression grammar precisely using ADTs (enums and structs). Make invalid AST states unrepresentable through the type system. Avoid primitive obsession: wrap raw strings in domain types (`Expression`, `Parameter`, `ParamType`). Prefer immutability by default.

### IV. Test-Driven Development (NON-NEGOTIABLE)

TDD is mandatory. Red-Green-Refactor cycle strictly enforced:
1. Write the failing test
2. Verify it fails
3. Write minimal implementation to pass
4. Verify it passes
5. Refactor if needed
6. Commit

Use `inspect(value, content="expected")` for snapshot testing. Port the official cucumber-expressions test suite as the primary acceptance criteria.

### V. Total Functions

All public functions MUST handle all inputs. Return `Result`/`Option` instead of panicking. Use `raise` with typed `suberror` for parse failures. Pattern match exhaustively; the compiler MUST catch missing cases.

## Design Constraints

- Parse a permissive superset grammar first, then validate (for better error messages)
- Compile expressions to regex internally for matching
- Support the full expression syntax: parameters, optional text, alternation, escaping
- Built-in parameter types: `{int}`, `{float}`, `{string}`, `{word}`, `{}`
- Custom parameter types via a registry
- All public types derive `Show`, `Eq`, `ToJson`, `FromJson`

## Development Workflow

- Use **`mise run`** for all build/test operations (file-based tasks in `mise-tasks/`)
- All commits MUST use **Conventional Commits** format: `type(scope): description`
- CHANGELOG.md is auto-generated by `git cliff` from conventional commits
- Publish to **mooncakes.io** as `moonrockz/cucumber-expressions`
- Use **beads** (`bd`) for issue tracking
- Use **speckit** for spec-driven development workflow

## Governance

This constitution governs all development on `moonrockz/cucumber-expressions`. Amendments require documentation in this file with version bump. All code changes MUST comply with these principles. Complexity MUST be justified against these principles.

**Version**: 1.0.0 | **Ratified**: 2026-02-21 | **Last Amended**: 2026-02-21
